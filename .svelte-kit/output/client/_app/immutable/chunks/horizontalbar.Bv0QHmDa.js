import{m as _,s as g,t as B,a as D,B as $,l as I,e as Y,f as G,n as J}from"./2.Bt4yhKeu.js";import H from"./colortools.E6k0jT9J.js";import{C as R,b as U,c as V,a as j,s as q}from"./colorscale.DCMEXqua.js";const Q=["rgb(204, 10, 17)","rgb(4, 109, 161)","#ff7f00","rgb(0, 178, 255)","rgb(245, 189, 44)","rgb(179, 179, 180)","rgb(128, 128, 128)","#000000"],W=["#ffd700","#ea5f94","#13F4EF","#fa8775","#cd34b5","#9d02d7","#0000ff"],T={guardian:Q,darkmode:W,"the-crunch":["#ffd700","#ea5f94","#13F4EF","#fa8775","#cd34b5","#9d02d7","#0000ff"]};class Mt{constructor(o){this.settings=o,this.keyOrder=[],this.sonicData={},this.x=null,this.y=null,this.margin=null,this.domain=null,this.width=o.width,this.height=o.height,this.features=null,this.data=null}render(o){console.log("render",o);let{modules:p,height:r,width:n,isMobile:m,colors:x,datum:a,data:X,keys:tt,calcs:et,title:at,subtitle:rt,source:st,dateFormat:C,timeInterval:b,dateParse:k,autoSort:w,xAxisLabel:ot,yAxisLabel:it,tooltip:lt,baseline:nt,interval:E,periodDateFormat:ct,xAxisFormat:c,x_axis_cross_y:ht,xColumn:e,yColumn:s,xMin:u,marginleft:F,margintop:A,marginbottom:S,marginright:v,maxXticks:N,barLabelsAbove:dt,footnote:mt,yMin:ut,trendline:ft,enableShowMore:yt,aria:gt,colorScheme:y,type:xt,labels:bt,userkey:L,dropdown:pt,periods:Ct,$tooltip:kt,$labels:wt,$enableShowMore:Ft,$dropdown:At,textScaling:P}=o||this.settings,h=JSON.parse(JSON.stringify(this.settings.keys));console.log("yColumn",s),s===""&&(s=h[0]),e===""&&(e=h[1]),h.splice(0,1),h=h.filter(t=>t!="Color"),m=_(),console.log(n,r),n=n-F-v,r=r-A-S,g("#chart");const f=g("#features");f.selectAll("*").remove(),x=new R,a=JSON.parse(JSON.stringify(X)),C!=""&&(k=B(C)),b!=""&&(b=b),console.log(c),c!=""?c=D(c):k?c=D("%d %b '%y"):(console.log("aaa"),c=t=>t),console.log("colorScheme",y);const M=H.getKeysColors({keys:h,userKey:L,option:{colorScheme:y}});x.set(M.keys,M.colors);let z=isNaN(a[0][s]);a.forEach(t=>{typeof t[s]=="string"&&!z&&(t[s]=+t[s]),typeof t[e]=="string"&&t[e]!=""?t[e]=+t[e]:typeof t[e]=="string"&&t[e]==""&&(t[e]=null)}),w!=null?w=="TRUE"&&(a=a.sort((t,d)=>$(+t[e],+d[e]))):a=a.sort((t,d)=>$(+t[e],+d[e]));var l=I().range([0,n]),i=U().range([0,r]).paddingInner(.45).paddingOuter(.45);i.domain(a.map(t=>t[s]));let K=Y(a,t=>t[e]);u!=""?u=+u:u=G(a,t=>t[e]),l.domain([u,K]).nice();var O;V(i),O=j(l).tickFormat(function(t){return J(t)}),m&&N!=null&&O.ticks(N),f.selectAll(".bar").data(a).enter().append("rect").attr("class","bar").attr("x",t=>l(Math.min(0,t[e]))).style("fill",t=>t.Color?t.Color:T[y][0]).attr("y",t=>i(t[s])).attr("width",t=>Math.abs(l(t[e])-l(0))).attr("height",i.bandwidth()),f.selectAll(".barText").data(a).enter().append("text").attr("class","barText").attr("x",t=>t[e]<0?l(0)+5:l(0)-5).attr("text-anchor",t=>{let d;return d=t[e]<0?"start":"end",d}).attr("y",t=>i(t[s])+(i.bandwidth()-4)).style("font-size",`${i.bandwidth()}px`).text(t=>t[s]),f.selectAll(".barNumber").data(a).enter().append("text").attr("class","barNumber").style("font-weight","bold").attr("text-anchor",t=>t[e]>0?"start":"end").attr("x",t=>t[e]>0?l(t[e])+5:l(t[e])-5).style("fill","#FFF").attr("y",t=>i(t[s])+(i.bandwidth()-4)).style("font-size",`${i.bandwidth()}px`).text(t=>J(t[e])),q(".y .tick").remove(),this.x=l,this.y=i,this.xColumn=e,this.yColumn=s,this.domainY=this.y.domain(),this.domainX=this.x.domain(),console.log("domainX",this.domainX),this.margin={left:F,right:v,top:A,bottom:S},this.width=n,this.height=r,this.keyOrder=h,this.sonicData=a,this.features=f,this.data=a,this.xAxisFormat=c,this.interval=E,this.colorScheme=y,this.textScaling=P}play(o,p){console.log("Playing bar chart"),console.log("sonicData",this.sonicData),o.duration/this.sonicData.length*1e3,console.log("options",o);const r=this;g("#positionCounterValue").text(r.data[0][r.xColumn]);function n(x,a){g("#features").append("circle").attr("cy",r.y(r.data[a][r.yColumn])+r.y.bandwidth()/2).attr("fill",()=>r.data[a].Color?r.data[a].Color:T[r.colorScheme][0]).attr("cx",r.x(r.data[a][r.xColumn])).attr("r",0).style("opacity",1).transition().duration(300).attr("r",r.textScaling*40).style("opacity",0).remove()}let m=["France","Portugal","Germany","Australia","Japan"];setTimeout(()=>{p.playAudio(o,this.domainX,this.domainY,this.interval,this.data,this.keyOrder,null,n,null,m=m)},1e3)}}export{Mt as default};
