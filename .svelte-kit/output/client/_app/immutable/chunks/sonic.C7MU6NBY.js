import{D as q,w as F,u as z,y as E,M as B,S as L,z as O,P as U,k as $,T as y,p as V,A as _,l as M,v as I}from"./2.Bt4yhKeu.js";const p=P=>new Promise(e=>setTimeout(e,P)),G={envelope:{attack:0,decay:.1,sustain:0,release:.1},oscillator:{modulationFrequency:.2,type:"sine"}};class H{constructor(e){this.destination=q,this.synths=[],this.kickDrum=null,this.click=null,this.panners=[],this.xTimeClicks=[],this.isPlaying=!1,this.hasRun=!1,this.notes=[],this.speech=window.speechSynthesis,F.forEach(t=>{this.notes.push(t.Frequency)})}async loadSynths(e){console.log("Loading synths..."),z();let t=[-.75,.75];e.simultaneous||(console.log("yeh?"),t=[0,0]);let o=E().domain([0,e.selectedInstruments.length-1]).range(t);console.log("pan domain",o.range()),this.kickDrum=new B().connect(this.destination),this.click=new L(G).connect(this.destination),e.selectedInstruments.forEach((a,n)=>{console.log(n);let f=O[a.instrument],g=f.Synth,S=a.instrument,k=f.Presets;console.log(g,S),console.log("pan value",o(n));let l=new U(o(n)).connect(this.destination);if(g!="Sampler"&&g!="Player"){let c=new $[g](k);return c.connect(l),this.synths[n]=c,!0}else if(g=="Sampler"&&(console.log("Sampler"),S!="Sad Trombone")){k.onload=()=>(console.log("samples loaded"),!0);let c=new $[g](k);c.connect(l),this.synths[n]=c}})}beep(e,t){return new Promise((o,a)=>{y.stop(),y.cancel();let n=this.synths[0];n.unsync(),n.triggerAttackRelease(e,.5),setTimeout(f,600);function f(){o({status:"success"})}}).catch(function(o){console.log(o),reject(o)})}speaker(e){return new Promise((t,o)=>{let a=this;if("speechSynthesis"in window){var n=new SpeechSynthesisUtterance;n.text=e,n.lang="en-GB";let f=V();f=="Firefox"&&(n.rate=1.1,n.lang="en-AU"),f=="Safari"&&(n.rate=1.1),a.speech.speak(n),n.onend=function(){t({status:"success"})}}else t({status:"no txt to speach"})}).catch(function(t){reject(t)})}playAudio(e,t,o,a,n=[],f,g,S,k=[]){let l=this;const c=e.duration/a.length;console.log("note",c),console.log("data",a),console.log("domainY",t);let v={},j=this.synths;this.hasRun;let R=Object.keys(a[0]),h=R[0];n.length===0&&(n=R.slice(1)),console.log(n),n.forEach(function(i){v[i]=[],a.forEach((s,m)=>{if(s[i]!=null){let w={};w[h]=s[h],w[i]=s[i],w.sonic_index=m,v[i].push(w)}})}),l.xTimeClicks=[];let A=[];a.forEach((i,s)=>{A.push(i[h])}),e.timeClick&&(l.xTimeClicks=_(A,e.timeClick));let d=[e.low,e.high];if(e.invertAudio&&(d=d.reverse()),e.scaleNotes){let i=this.notes.findIndex(m=>m==e.low),s=this.notes.findIndex(m=>m==e.high);d=this.notes.slice(i,s+1),e.invertAudio&&(d=d.reverse())}console.log("range",d);let u=null;e.scaleNotes?u=E().domain(t).range(d):u=M().domain(t).range(d),M().domain(t).range([-12,0]);function D(i){console.log("makeNoise"),y.stop(),y.cancel(),i.forEach(async function(s){let m=n.indexOf(s);console.log(m);let w=j[m];e.audioRendering=="discrete"&&(w.sync(),l.kickDrum.sync());let b=v[s];k.length>0&&(console.log("selected",k),b=v[s].filter(r=>k.includes(r[h])));for(let r=0;r<b.length;r++){const T=b[r];e.audioRendering=="discrete"?e.selectedInstrument!="Sad Trombone"&&e.selectedInstrument!="Cheering"&&(w.triggerAttackRelease(u(T[s]),c,c*r),l.xTimeClicks.some(N=>N.getTime()===T[h].getTime())&&l.kickDrum.triggerAttackRelease("C2","8n",c*r),y.schedule(function(){g(s,r,b.length)},r*c)):e.audioRendering=="continuous"?(console.log("making continuous noise"),r==0?(w.triggerAttackRelease(u(T[s]),b.length*c),f(s)):y.schedule(function(){w.frequency.rampTo(u(T[s]),c)},r*c)):e.audioRendering=="categorical"&&(console.log("categorical"),e.chartMode==="fully accessible"?await l.speaker(T[h]):await p(500),g(s,T.sonic_index,b.length),await l.beep(u(T[s])))}}),y.position="0:0:0",y.start()}let x=this.isPlaying;async function C(){if(!x){if(x=!0,e.chartMode==="fully accessible"){let i=t[0],s=t[1];typeof i=="number"&&(i=I(i),s=I(s)),await l.speaker(`The lowest value on the chart is ${i}, and it sounds like `),S([a[0][h],t[0]]),await l.beep(u(t[0])),await p(1200),await l.speaker(`The highest value on the chart is ${s}, and it sounds like `),S([a[0][h],t[1]]),await l.beep(u(t[1])),await p(1200),await l.speaker(`Each note is a ${e.interval}, and the chart goes from ${o[0]} to ${o[1]}`)}else e.chartMode==="human does voiceover"&&(console.log(`The lowest value on the chart is ${t[0]}, and it sounds like `),S([a[0][h],t[0]]),await l.beep(u(t[0])),await p(1200),console.log(`The highest value on the chart is ${t[1]}, and it sounds like `),S([a[0][h],t[1]]),await l.beep(u(t[1])),await p(1200));if(e.simultaneous==!0)console.log("simultaneous"),D(n);else if(e.simultaneous==!1){async function i(){console.log("keys",n);for await(const s of n)console.log(s),e.chartMode==="fully accessible"?await l.speaker(`${s}`):e.chartMode==="human does voiceover"&&await p(1200),D([s]),await p(v[s].length*c*1e3+1e3)}i()}await p(3e3),x=!1}}C()}}export{H as default};
