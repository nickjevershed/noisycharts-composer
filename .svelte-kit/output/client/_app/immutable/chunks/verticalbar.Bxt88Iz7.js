var Q=Object.defineProperty;var U=(g,r,s)=>r in g?Q(g,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):g[r]=s;var M=(g,r,s)=>U(g,typeof r!="symbol"?r+"":r,s);import{m as W,s as c,t as Z,a as x,b as N,c as X,d as B,l as tt,e as et,f as at,n as R}from"./2.Bt4yhKeu.js";import rt from"./colortools.E6k0jT9J.js";import{C as it,t as j,b as st,a as q,c as z,s as p}from"./colorscale.DCMEXqua.js";class Ot{constructor(r){M(this,"animateDiscrete",(r,s,t,h)=>{const e=this;let a=e.sonicData.slice(0,t+1),d=e.features.selectAll(".bar").data(a);d.exit().remove(),d.enter().append("rect").attr("class","bar").attr("x",function(m){return e.x(m[e.xVar])}).style("fill",function(){return e.colors.get(e.spareKeys[0])}).attr("y",function(m){return e.y(Math.max(m[e.spareKeys[0]],0))}).attr("width",e.x.bandwidth()).attr("height",function(m){return Math.abs(e.y(m[e.spareKeys[0]])-e.y(0))}),c("#features").append("circle").attr("cy",e.y(e.data[t][e.spareKeys[0]])).attr("fill",e.colors.get(e.spareKeys[0])).attr("cx",e.x(e.data[t][e.xVar])+e.x.bandwidth()/2).attr("r",0).style("opacity",1).transition().duration(300).attr("r",40).style("opacity",0).remove()});M(this,"makeCircle",(r,s,t=null)=>{const h=this;c("#features").append("circle").attr("cy",h.y(s)).attr("fill",h.colors.get(t)).attr("cx",h.x(r)+h.x.bandwidth()/2).attr("r",0).style("opacity",1).transition().duration(500).attr("r",40).style("opacity",0).remove()});this.settings=r,this.spareKeys=JSON.parse(JSON.stringify(r.keys)),this.xVar=r.xColumn!=""?r.xColumn:this.spareKeys[0],this.spareKeys.splice(0,1),this.keyOrder=[],this.sonicData={},this.x=null,this.y=null,this.margin=null,this.domain=null,this.width=r.width,this.height=r.height,this.features=null,this.data=null}render(){let{modules:r,height:s,width:t,isMobile:h,colors:e,datum:a,data:d,keys:m,calcs:v,title:b,subtitle:ot,source:nt,dateFormat:D,timeInterval:y,dateParse:P,xAxisLabel:lt,yAxisLabel:ct,tooltip:ht,baseline:dt,interval:E,periodDateFormat:mt,xAxisFormat:n,xAxisDateFormat:k,x_axis_cross_y:yt,xColumn:ut,yColumn:xt,marginleft:Y,margintop:$,marginbottom:O,marginright:T,footnote:ft,minY:pt,trendline:gt,enableShowMore:bt,aria:kt,colorScheme:L,type:wt,labels:Vt,userkey:G,dropdown:Kt,periods:At,$tooltip:vt,$labels:Dt,$enableShowMore:Ft,$dropdown:Ct,textScaling:_}=this.settings,l=this.spareKeys;l=l.slice(0,1),console.log("spareKeys",l),h=W(),t=t-Y-T,s=s-$-O;let o=this.xVar;c("#chart");const K=c("#features");K.selectAll("*").remove(),e=new it,a=d,D!=""&&(P=Z(D)),y!=""&&(y=y),console.log("xAxisFormat",n,k),k!=""?n=x(k):P?n=x("%d %b '%y"):(console.log("aaa"),n=i=>i),console.log("colorScheme",L);const I=rt.getKeysColors({keys:l,userKey:G,option:{colorScheme:L}});e.set(I.keys,I.colors),console.log(e.get([l[0]]));let w;y!=""?(y=="year"&&(w=N.range(a[0][o],N.offset(a[a.length-1][o],1))),y=="day"&&(w=X.range(a[0][o],X.offset(a[a.length-1][o],1))),y=="month"&&(w=j.range(a[0][o],j.offset(a[a.length-1][o],1))),y=="week"&&(w=B.range(a[0][o],B.offset(a[a.length-1][o],1)))):w=a.map(i=>i[o]),c("#chartKey").html("");const u=st().range([0,t]).paddingInner(.2);u.domain(w);const f=tt().range([s,0]);let V=null;k!=""?(n=x(k),V=x(k)):parseTime?D=="%Y"?(n=x("%Y"),V=x("%Y")):(n=x("%d %b '%y"),V=x("%d %b '%y")):(n=i=>i,V=i=>i);let H=et(a,i=>i[l[0]]);at(a,i=>i[l[0]]),f.domain([0,H]);var F,C;let J=10;a.length<=5&&(J=1);var A=u.domain().filter(function(i,S){return!(S%J)});console.log("ticks",A),h&&(A=u.domain().filter(function(i,S){return!(S%20)})),h?(F=q(u).tickValues(A).tickFormat(n),C=z(f).tickFormat(function(i){return R(i)}).ticks(5)):(F=q(u).tickValues(A).tickFormat(n),C=z(f).tickFormat(function(i){return R(i)}).ticks(5)),K.append("g").attr("class","x").attr("transform","translate(0,"+s+")").call(F),K.append("g").attr("class","y").call(C),p(".y .tick line").style("stroke-dasharray","2 2").attr("x2",t),p(".y path").style("stroke-width","0"),p(".tick line").attr("stroke","#767676"),p(".tick text").attr("fill","#767676"),p(".x .tick text").attr("y",`${_*10}`),p(".y .tick text").attr("x",`-${_*8}`),p(".domain").attr("stroke","#767676"),K.selectAll(".bar").data(a).enter().append("rect").attr("class","bar").attr("x",function(i){return u(i[o])}).style("fill",function(){return e.get(l[0])}).attr("y",function(i){return f(Math.max(i[l[0]],0))}).attr("width",u.bandwidth()).attr("height",function(i){return Math.abs(f(i[l[0]])-f(0))}),c("#positionCounterTitle").text(o),c("#positionCounterValue").text(n(a[a.length-1][o])),this.x=u,this.y=f,this.xVar=o,this.domainY=this.y.domain(),this.domainX=[this.x.domain()[0],this.x.domain()[this.x.domain().length-1]],this.xVarFormatterPosition=V,this.margin={left:Y,right:T,top:$,bottom:O},this.width=t,this.height=s,this.keyOrder=l,this.sonicData=a,this.features=K,this.data=a,this.colors=e,this.xAxisFormat=n,this.interval=E,this.xVarFormatterPosition=V}resetAnimation(r){const s=this;c("#positionCounterValue").text(s.xVarFormatterPosition(s.data[0][s.xVar]))}play(r,s){console.log("Playing bar chart"),console.log("sonicData",this.sonicData),r.duration/this.sonicData.length*1e3,console.log("options",r);const t=this;t.features.selectAll(".bar").remove(),c("#positionCounterValue").text(t.data[0][t.xVar]);function e(a,d){c("#positionCounterValue").text(t.xAxisFormat(t.data[d][t.xVar]));let m=t.sonicData.slice(0,d+1),v=t.features.selectAll(".bar").data(m);v.exit().remove(),v.enter().append("rect").attr("class","bar").attr("x",function(b){return t.x(b[t.xVar])}).style("fill",function(){return"rgb(204, 10, 17)"}).attr("y",function(b){return t.y(Math.max(b[t.spareKeys[0]],0))}).attr("width",t.x.bandwidth()).attr("height",function(b){return Math.abs(t.y(b[t.spareKeys[0]])-t.y(0))}),c("#features").append("circle").attr("cy",t.y(t.data[d][t.spareKeys[0]])).attr("fill","rgb(204, 10, 17)").attr("cx",t.x(t.data[d][t.xVar])+t.x.bandwidth()/2).attr("r",0).style("opacity",1).transition().duration(300).attr("r",40).style("opacity",0).remove()}setTimeout(()=>{s.playAudio(r,this.domainY,this.domainX,this.interval,this.data,this.keyOrder,null,e)},1e3)}}export{Ot as default};
