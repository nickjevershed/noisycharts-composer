import{m as z,s as h,t as G,a as T,b as Y,c as E,d as L,l as H,e as Q,f as U,n as P}from"./2.Bt4yhKeu.js";import W from"./colortools.E6k0jT9J.js";import{C as Z,t as _,b as tt,a as I,c as X,s as y}from"./colorscale.DCMEXqua.js";class Ot{constructor(r){this.settings=r,this.dataKeys=JSON.parse(JSON.stringify(r.keys)),this.xVar=r.xColumn!=""?r.xColumn:this.dataKeys[0],this.dataKeys.splice(0,1),this.keyOrder=[],this.sonicData={},this.x=null,this.y=null,this.margin=null,this.domain=null,this.width=r.width,this.height=r.height,this.features=null,this.data=null}render(){let{modules:r,height:d,width:t,isMobile:g,colors:b,datum:e,data:f,keys:D,calcs:w,title:u,subtitle:et,source:it,dateFormat:K,timeInterval:n,dateParse:k,xAxisLabel:rt,yAxisLabel:st,tooltip:ot,baseline:nt,interval:B,periodDateFormat:lt,xAxisFormat:s,x_axis_cross_y:ct,xColumn:ht,yColumn:dt,marginleft:S,margintop:V,marginbottom:F,marginright:O,footnote:mt,minY:yt,trendline:ft,enableShowMore:ut,aria:xt,colorScheme:R,type:pt,labels:gt,userkey:j,dropdown:bt,periods:kt,$tooltip:wt,$labels:vt,$enableShowMore:At,$dropdown:Ct,textScaling:M}=this.settings,l=this.dataKeys;g=z(),t=t-S-O,d=d-V-F;let i=this.xVar;h("#chart");const p=h("#features");p.selectAll("*").remove(),b=new Z,e=JSON.parse(JSON.stringify(f)),K!=""&&(k=G(K)),n!=""&&(n=n),console.log(s),s!=""?s=T(s):k?s=T("%d %b '%y"):s=a=>a;const $=W.getKeysColors({keys:l,userKey:j,option:{colorScheme:R}});b.set($.keys,$.colors),e.forEach(a=>{k!=""&&typeof a[i]=="string"&&(a[i]=k(a[i])),l.forEach((o,Kt)=>{a[o]=+a[o]})});let x;n!=""?(n=="year"&&(x=Y.range(e[0][i],Y.offset(e[e.length-1][i],1))),n=="day"&&(x=E.range(e[0][i],E.offset(e[e.length-1][i],1))),n=="month"&&(x=_.range(e[0][i],_.offset(e[e.length-1][i],1))),n=="week"&&(x=L.range(e[0][i],L.offset(e[e.length-1][i],1)))):x=e.map(a=>a[i]);const J=h("#chartKey");J.html(""),JSON.parse(JSON.stringify(l)).forEach(a=>{console.log("chartkey",a);const o=J.append("div").attr("class","keyDiv");o.append("span").attr("class","keyCircle").style("background-color","rgb(204, 10, 17)"),o.append("span").attr("class","keyText").text(a)});const c=tt().range([0,t]).paddingInner(.2);c.domain(x);const m=H().range([d,0]);let q=Q(e,a=>a[l[0]]);U(e,a=>a[l[0]]),m.domain([0,q]);var v,A;let N=10;e.length<=5&&(N=1);var C=c.domain().filter(function(a,o){return!(o%N)});g&&(C=c.domain().filter(function(a,o){return!(o%20)})),g?(v=I(c).tickValues(C).tickFormat(s),A=X(m).tickFormat(function(a){return P(a)}).ticks(5)):(v=I(c).tickValues(C).tickFormat(s),A=X(m).tickFormat(function(a){return P(a)}).ticks(5)),p.append("g").attr("class","x").attr("transform","translate(0,"+d+")").call(v),p.append("g").attr("class","y").call(A),y(".y .tick line").style("stroke-dasharray","2 2").attr("x2",t),y(".y path").style("stroke-width","0"),y(".tick line").attr("stroke","#767676"),y(".tick text").attr("fill","#767676"),y(".x .tick text").attr("y",`${M*10}`),y(".y .tick text").attr("x",`-${M*8}`),y(".domain").attr("stroke","#767676"),p.selectAll(".bar").data(e).enter().append("rect").attr("class","bar").attr("x",function(a){return c(a[i])}).style("fill",function(){return"rgb(204, 10, 17)"}).attr("y",function(a){return m(Math.max(a[l[0]],0))}).attr("width",c.bandwidth()).attr("height",function(a){return Math.abs(m(a[l[0]])-m(0))}),h("#positionCounterTitle").text(i),h("#positionCounterValue").text(s(e[e.length-1][i])),this.x=c,this.y=m,this.xVar=i,this.domainY=this.y.domain(),this.domainX=[this.x.domain()[0],this.x.domain()[this.x.domain().length-1]],this.margin={left:S,right:O,top:V,bottom:F},this.width=t,this.height=d,this.keyOrder=l,this.sonicData=e,this.features=p,this.data=e,this.xAxisFormat=s,this.interval=B}play(r,d){console.log("Playing bar chart"),console.log("sonicData",this.sonicData),r.duration/this.sonicData.length*1e3,console.log("options",r);const t=this;t.features.selectAll(".bar").remove(),h("#positionCounterValue").text(t.data[0][t.xVar]);function b(e,f){h("#positionCounterValue").text(t.xAxisFormat(t.data[f][t.xVar]));let D=t.sonicData.slice(0,f+1),w=t.features.selectAll(".bar").data(D);w.exit().remove(),w.enter().append("rect").attr("class","bar").attr("x",function(u){return t.x(u[t.xVar])}).style("fill",function(){return"rgb(204, 10, 17)"}).attr("y",function(u){return t.y(Math.max(u[t.dataKeys[0]],0))}).attr("width",t.x.bandwidth()).attr("height",function(u){return Math.abs(t.y(u[t.dataKeys[0]])-t.y(0))}),h("#features").append("circle").attr("cy",t.y(t.data[f][t.dataKeys[0]])).attr("fill","rgb(204, 10, 17)").attr("cx",t.x(t.data[f][t.xVar])+t.x.bandwidth()/2).attr("r",0).style("opacity",1).transition().duration(300).attr("r",40).style("opacity",0).remove()}setTimeout(()=>{d.playAudio(r,this.domainY,this.domainX,this.interval,this.data,this.keyOrder,null,b)},1e3)}}export{Ot as default};
