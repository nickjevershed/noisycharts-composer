var $t=Object.defineProperty;var At=(w,e,l)=>e in w?$t(w,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):w[e]=l;var E=(w,e,l)=>At(w,typeof e!="symbol"?e+"":e,l);import{C as Ct,d as vt,e as Tt,l as Kt,a as Vt,c as Lt,s as y,f as B}from"./colorscale.DCMEXqua.js";import{l as G,s as p,t as at,g as kt,e as St,f as _t,h as it,a as C,n as Dt,i as F}from"./2.Bt4yhKeu.js";import Et from"./colortools.E6k0jT9J.js";class re{constructor(e){E(this,"animateDiscrete",(e,l,a,i)=>{const s=this;var h=e*1e3;let c=F(l),$=p(`#${c}_clip rect`);p("#positionCounterValue").text(s.xVarFormatterPosition(s.data[a][s.xVar])),p("#features").append("circle").attr("cy",s.y(s.data[a][l])).attr("fill",s.colors.get(l)).attr("cx",s.x(s.data[a][s.xVar])).attr("r",0).style("opacity",1).transition().duration(300).attr("r",40).style("opacity",0).remove(),$.transition().duration(h).ease(B).attr("width",s.x(s.data[a][s.xVar])),a==i-1&&($.attr("width",s.width),setTimeout(()=>{y(`.${c}_label`).style("opacity",1)},h))});E(this,"animateContinuous",(e,l,a,i)=>{const s=this;let h=F(l),c=p(`#${h}_clip rect`);a==0&&c.transition().duration(e*i*1e3).ease(B).attr("width",s.width).on("end",function(){y(`.${h}_label`).style("opacity",1)}),p("#positionCounterValue").text(s.xVarFormatterPosition(s.data[a][s.xVar]))});E(this,"makeCircle",(e,l,a=null)=>{const i=this;console.log(e,l,a,i.x(e),i.y(l),i.colors.get(a)),p("#features").append("circle").attr("cy",i.y(l)).attr("fill",i.colors.get(a)).attr("cx",i.x(e)).attr("r",0).style("opacity",1).transition().duration(500).attr("r",40).style("opacity",0).remove()});this.settings=e,this.spareKeys=JSON.parse(JSON.stringify(e.keys)),this.xVar=e.xColumn!=""?e.xColumn:this.spareKeys[0],this.spareKeys.splice(0,1),this.keyOrder=[],this.sonicData={},this.x=null,this.y=null,this.margin=null,this.domain=null,this.width=e.width,this.height=e.height,this.data=null,this.xAxisType=null,this.xTimeClicks=[]}render(e){let{modules:l,height:a,width:i,isMobile:s,colors:h,datum:c,data:$,key:Ft,keys:Yt,title:Ot,subtitle:Pt,source:Nt,dateFormat:Y,yScaleType:O,xAxisLabel:rt,yAxisLabel:st,xAxisFormat:v,xAxisDateFormat:P,interval:lt,baseline:Rt,tooltip:zt,periodDateFormat:H,marginleft:N,margintop:I,marginbottom:U,marginright:T,minX:Xt,minY:R,maxY:z,footnote:Jt,enableShowMore:Mt,aria:Bt,colorScheme:j,lineLabelling:S,type:Gt,userkey:nt,periods:_,labels:ot,dropdown:Ht,x_axis_cross_y:W,breaks:q,lines:K,invertY:Q,timeClick:It,xColumn:Ut,yColumn:jt,$tooltip:Wt,$labels:qt,$enableShowMore:Qt,$dropdown:Zt,textScaling:A}=e||this.settings;c=$;let ct=i;i=i-N-T,a=a-I-U,S=!1;let d=G().rangeRound([a,0]);Q==="TRUE"&&(d=G().rangeRound([0,a]));let X={},J="yes",D=[],V={},ht=[],r,x=this.xVar,L=this.spareKeys;var dt=this;const pt=p("#chart"),o=p("#features"),Z=p("#chartKey");o.selectAll("*").remove(),h=new Ct;const tt=Et.getKeysColors({spareKeys:dt.spareKeys,userKey:nt,option:{colorScheme:j}});h.set(tt.spareKeys,tt.colors),q!=""&&(J=q),O!=""&&(d=vt[O]().range([0,a]).nice());const g=Y!=""?at(Y):"",M=H!=""?at(H):"";T=T+kt(pt,L,s,S),i=ct-T-N,g&&typeof x=="string"?(this.xAxisType="time",r=Tt().rangeRound([0,i])):x instanceof Date||(r=G().rangeRound([0,i])),L.forEach(t=>{X[t]=Kt().x(n=>r(n[x])).y(n=>d(n[t])),J==="yes"&&X[t].defined(n=>n),c.forEach(n=>{D.push(n[t])})}),S===!1&&(Z.html(""),JSON.parse(JSON.stringify(L)).forEach(n=>{const b=Z.append("div").attr("class","keyDiv");b.append("span").attr("class","keyCircle").style("background-color",()=>h.get(n)),b.append("span").attr("class","keyText").text(n)})),c.forEach(t=>{ht.push(t[x])}),L.forEach(t=>{V[t]=[],c.forEach(n=>{if(n[t]!=null){let b={};b[x]=n[x],b[t]=n[t],V[t].push(b)}else J==="yes"&&V[t].push(null)})}),ot.forEach(t=>{g&&typeof t.x=="string"&&(t.x=g(t.x)),typeof t.y=="string"&&(t.y=+t.y),typeof t.offset=="string"&&(t.offset=+t.offset)}),K&&K.forEach(t=>{g&&typeof t.x1=="string"&&(t.x1=g(t.x1),t.x2=g(t.x2)),typeof t.y1=="string"&&(t.y1=+t.y1,t.y2=+t.y2)}),_.forEach(t=>{typeof t.start=="string"&&(M!=""?(t.start=M(t.start),t.end!=""?(t.end=M(t.end),t.middle=new Date((t.start.getTime()+t.end.getTime())/2)):t.middle=t.start):(t.start=+t.start,t.end!=""?(t.end=+t.end,t.middle=(t.end+t.start)/2):t.middle=t.start))});const xt=z&&z!==""?parseInt(z):St(D),k=R&&R!==""?parseInt(R):_t(D);let yt=it(c,t=>t[x]);r.domain(yt),d.domain([k,xt]);const mt=Math.round(i/A/110),ft=O==="scaleLog"?3:5,et=Vt(r).ticks(mt);let u=null;P!=""?(v=C(P),u=C(P)):g?Y=="%Y"?(v=C("%Y"),u=C("%Y")):(v=C("%d %b '%y"),u=C("%d %b '%y")):(v=t=>t,u=t=>t),et.tickFormat(v);const ut=Lt(d).tickFormat(t=>Dt(t)).ticks(ft).tickSize(-i);y(".periodLine").remove(),y(".periodLabel").remove(),p("#positionCounterTitle").text(x),p("#positionCounterValue").text(u(c[c.length-1][x])),o.selectAll(".periodLine .start").datum(_).enter().append("line").attr("x1",t=>r(t.start)).attr("y1",0).attr("x2",t=>r(t.start)).attr("y2",a).attr("class","periodLine mobHide start").attr("opacity",t=>t.start<r.domain()[0]?0:1).attr("stroke-width",1),o.selectAll(".periodLine .end").datum(_.filter(t=>t.end!="")).enter().append("line").attr("x1",t=>r(t.end)).attr("y1",0).attr("x2",t=>r(t.end)).attr("y2",a).attr("class","periodLine mobHide end").attr("opacity",t=>t.end>r.domain()[1]?0:1).attr("stroke-width",1),o.selectAll(".periodLabel").datum(_).enter().append("text").attr("x",t=>{if(t.labelAlign=="middle")return r(t.middle);if(t.labelAlign=="start")return r(t.start)+5}).attr("y",-5).attr("text-anchor",t=>t.labelAlign).attr("class","periodLabel mobHide").attr("opacity",1).text(t=>t.label),o.append("g").attr("class","y dashed axis").call(ut).style("stroke-dasharray","2 2").attr("stroke-width",3),Q==="TRUE"&&(o.append("line").attr("x1",r(r.domain()[0])).attr("y1",d(k)).attr("x2",r(r.domain()[1])).attr("y2",d(k)).attr("class","zero dashed").style("stroke-dasharray","2 2").attr("stroke-width",3),o.append("text").attr("class","addTick").attr("x",-10).attr("y",d(k)).attr("dy","0.32em").text(k)),o.append("g").attr("class","x axis").attr("transform",()=>W!=""?"translate(0,"+d(W)+")":"translate(0,"+a+")").call(et),o.select(".y .domain").remove(),o.append("text").attr("y",6).attr("dy","0.71em").attr("text-anchor","end").style("font-size",`${A*12}px`).text(st),o.append("text").attr("x",i).attr("y",a-6).attr("text-anchor","end").text(rt),y(".x .tick text").attr("y",`${A*10}`),y(".y .tick text").attr("x",`-${A*8}`),y(".addTick").attr("x",`-${A*8+5}`),K&&(o.selectAll(".line").data(K).enter().append("line").attr("x1",t=>r(t.x1)).attr("y1",t=>d(t.y1)).attr("x2",t=>r(t.x2)).attr("y2",t=>d(t.y1)).attr("class","line").attr("stroke-dasharray","2,4").attr("stroke-width",3),o.selectAll(".lineText").data(K).enter().append("text").attr("x",t=>r(t.x1)).attr("y",t=>d(t.y1)-5).attr("class","lineText").attr("opacity",1).style("font-size",`${A*12}px`).text(t=>t.text)),L.forEach(t=>{let n=F(t);o.append("clipPath").attr("id",`${n}_clip`).attr("class","clippy").append("rect").attr("width",i).attr("y",-5).attr("height",a+10),o.append("path").datum(V[t]).attr("fill","none").attr("class","dataLine").attr("id",`${n}_line`).attr("clip-path",`url(#${n}_clip)`).attr("stroke",f=>h.get(t)).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("stroke-width",4).attr("d",X[t]);const m=V[t].filter(f=>f!=null);let bt="start",wt=0;this.keyOrder.push(t),this.sonicData[t]=m,o.append("circle").attr("cy",f=>d(m[m.length-1][t])).attr("fill",f=>h.get(t)).attr("cx",f=>r(m[m.length-1][x])).attr("r",8).attr("class",`${n}_label linelabels`).style("opacity",1),S&&o.append("text").attr("class",`lineLabels ${n}_label`).style("font-weight","bold").style("font-size","15px").attr("y",f=>d(m[m.length-1][t])+4+wt).attr("x",f=>r(m[m.length-1][x])+5).style("opacity",1).attr("text-anchor",bt).attr("fill",f=>h.get(t)).text(f=>t)}),this.x=r,this.y=d,this.xVar=x,this.domainY=it(D),this.domainX=[u(this.x.domain()[0]),u(this.x.domain()[this.x.domain().length-1])],this.margin={left:N,right:T,top:I,bottom:U},this.width=i,this.height=a,this.data=c,this.colors=h,this.xVarFormatterPosition=u,this.interval=lt,this.colorScheme=j;const gt=`The lowest value on the chart is ${this.domainY[0]}, and it sounds like [BONG]. 
The highest value on the chart is ${this.domainY[1]}, and it sounds like [BING].
Each note is a ${this.interval}, and the chart goes from ${this.domainX[0]} to ${this.domainX[1]}`;p("#voiceOverScript").property("value",gt)}resetAnimation(e){const l=this;e.animationStyle=="playthrough"&&(y(".clippy rect").attr("width",0),y(".linelabels").style("opacity",0)),p("#positionCounterValue").text(l.xVarFormatterPosition(l.data[0][l.xVar]))}play(e,l){const a=this;function i(h){let c=F(h),$=p(`#${c}_clip rect`);e.audioRendering=="continuous"&&$.transition().duration(e.duration*1e3).ease(B).attr("width",a.width).on("end",function(){y(`.${c}_label`).style("opacity",1)})}let s=this.spareKeys;setTimeout(()=>{l.playAudio(e,this.domainY,this.domainX,this.data,s,i,newAnimateDiscrete,makeCircle)},2e3)}}export{re as default};
